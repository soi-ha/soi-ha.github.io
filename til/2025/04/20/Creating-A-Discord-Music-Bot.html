<!DOCTYPE html>
<html lang="ko">
	<head>
	<link href="https://gmpg.org/xfn/11" rel="profile" />
	<link rel="canonical" href="https://soi-ha.github.io/" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="google-site-verification" content="qN4GDLliD7yUtladZQRlgUB6Xnm-2G2G0yEVA44Ls5k" />

	<!-- Enable responsiveness on mobile devices-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
	<meta name="robots" content="index, follow" />
	<meta name="keywords" content="프론트엔드, frontend, FE, 개발자" />
	<meta name="description" content="프론트엔드 개발자 소하의 개발 블로그" />

	<!-- Open Graph -->
	<meta property="og:title" content="Soha의 develog" />
	<meta property="og:description" content="프론트엔드 개발자 소하의 개발 블로그" />
	<meta property="og:image" content="https://soi-ha.github.io/favicon.png" />
	<meta property="og:url" content="https://soi-ha.github.io/" />

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content="Soha의 develog" />
	<meta name="twitter:description" content="프론트엔드 개발자 소하의 개발 블로그" />
	<meta name="twitter:image" content="https://soi-ha.github.io/favicon.png" />

	<title>
		 디스코드(Discord) 노래봇 만들기 🎵 (with Node.js) &middot; Soha 
	</title>

	


	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css" /> 

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

	<!-- Icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

	<!-- RSS -->
	<link
		rel="alternate"
		type="application/rss+xml"
		title="RSS"
		href="/feed.xml"
	/>

	<!-- Additional head bits without overriding original head -->
</head>


	<body class="post">
		<div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Soha
      </a>
    </div>
    <p class="lead">프론트엔드 개발자가 되기 위한 발걸음 기록</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  


  


  
    
  

  
    
      <a class="category-link "
          href="/category/TIL.html">TIL</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/project.html">Project</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/sohaLog.html">Soha's Log</a>
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  &copy; 2025.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

		<main class="container"><header>
  <h1 class="post-title">디스코드(Discord) 노래봇 만들기 🎵 (with Node.js)</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">20 Apr 2025</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/TIL.html">
          TIL
        </a>
      
    
  </span>
</div>


  <div class="post-body">
    <h2 id="나는-어쩌다가-디스코드-노래봇을-만들게-되었는가">나는 어쩌다가 디스코드 노래봇을 만들게 되었는가…</h2>

<p>때는 4월 17일 20시.. 공부를 하기 위해 책상에 앉아 디스코드에 접속하여 서버에서 기존에 사용하던 노래봇을 실행하려 했는데.. 유튜브 검색이 제대로 작동하지 않았다. 그래서 나는 다른 노래봇을 새롭게 불러와 서버에 실행했지만? 또 안됐다. 그렇게 한국어를 지원하는 어느정도 인지도가 있는 노래봇만 6개를 실행해봤다. 근데, 내가 원하는 유튜브로 검색하여 실행이 제대로 돌아가지 않았다.</p>

<p><img width="519" alt="디스코드 노래봇 입장 채팅" src="https://github.com/user-attachments/assets/7ebbd883-0215-4ab8-a9c8-1f4bd091c52b" /></p>

<p>원하는대로 돌아가지 않아 약간 빡친(?) 나는, 너가 이기나 내가 이기나 해보자는 심보로 디스코드 노래봇을 어떻게 만드는지 찾아봤다. 어렵지 않으면 내가 만드는게 더 빠를 것 같다는 생각이 들었다. 오, 근데 간단하게 찾아보니 그리 어렵지 않고 주로 JS 혹은 Python으로 만드는 것 같았다. 직접 만드는게 진짜 더 좋겠는데…? 라는 생각에, 나는 계획에도 없던 디스코드 노래봇을 만들게 되었다 ^^!</p>

<h2 id="-나만의-디스코드-노래봇-대하-만들기">🦐 나만의 디스코드 노래봇, 대하 만들기</h2>

<p>나의 디스코드 노래봇의 이름은 ‘대하’이다. 이름이 대하인 이유는.. 내 닉네임 ‘소하’에서 ‘소’를 작을 소로 보고 큰 ‘대’로 바꿔 노래봇의 이름을 대하로 지어줬다. 나의 분신같은 친구니까. ^~^</p>

<p>내가 만들 디스코드 노래봇은 Node.js 환경에서 ‘discord.js’와 관련된 라이브러리를 활용하여 구현했다. 코드가 복잡한 것 하나 없이 매우 간단하게 1시간이면 만들 수 있다.</p>

<h2 id="-목표">🎯 목표</h2>

<p>일단 내가 만들 디스코드 노래봇의 목표는 다음과 같다.</p>

<ul>
  <li>디스코드 서버에서 명령어를 입력하면 <strong>유튜브에서 노래 검색 및 재생</strong> &lt;- 유튜브 기반 검색과 재생이 매우 중요!!</li>
  <li>기본적인 명령어: <code class="language-plaintext highlighter-rouge">/재생</code>, <code class="language-plaintext highlighter-rouge">/스킵</code>, <code class="language-plaintext highlighter-rouge">/대기열</code>, <code class="language-plaintext highlighter-rouge">/종료</code></li>
  <li>봇은 지정된 서버에서만 사용 가능 (내가 존재하는 서버에서만 사용할 것이기 때문)</li>
</ul>

<h2 id="️-준비물">🛠️ 준비물</h2>

<ul>
  <li>VSCode</li>
  <li>Node.js (LTS 버전 권장)</li>
  <li>Discord 계정 및 디스코드 개발자 포털에서 봇 생성 후 토큰 발급</li>
  <li>FFmpeg 설치</li>
</ul>

<h2 id="-노래봇을-만들어-보자">🔧 노래봇을 만들어 보자!</h2>

<h3 id="1-디스코드-개발자-포털-설정">1. 디스코드 개발자 포털 설정</h3>

<p>디스코드 개발자 포털 설정은 어렵지 않다! 아래 이미지와 글을 잘 읽고 따라오면 쉽게 생성할 수 있다.</p>

<h4 id="1-새-애플리케이션-생성">1. 새 애플리케이션 생성</h4>

<p><a href="https://discord.com/developers/applications">디스코드 개발자 포털</a>로 이동하여 로그인을 하고, 새 애플리케이션 생성 버튼을 클릭한다.</p>

<p><img width="812" alt="애플리케이션 생성" src="https://github.com/user-attachments/assets/ae2d41cc-30fa-4b76-b304-bed69bd989ec" /></p>

<p>애플리케이션의 이름을 작성하고 Create 버튼을 클릭하면,</p>

<p><img width="812" alt="애플리케이션 이름 작성" src="https://github.com/user-attachments/assets/3f58d043-e641-429a-a3fe-d5163bfa02cb" /></p>

<p>애플리케이션 생성이 완료된다.</p>

<p><img width="812" alt="애플리케이션 생성 완료" src="https://github.com/user-attachments/assets/f28e097e-a775-42c7-8798-ff6bd256cb42" /></p>

<p>Applicaion ID와 Public Key가 생성된 것을 확인할 수 있다. (이 두가지 정보는 이번 디스코드 노래봇 생성에는 사용되지 않음.)</p>

<h4 id="2-bot-token-생성">2. Bot Token 생성</h4>

<p>위 이미지에서 왼쪽 “Bot”을 클릭하고 “Add Bot” 클릭하면 Bot이 생성된다.<br />
그리고 Bot 생성하고 Reset Token 버턴을 클릭하면 토큰이 만들어진다.<br />
이 토큰(Token)을 복사하여 저장해둔다. 혹은 <code class="language-plaintext highlighter-rouge">.env</code> 파일에 보관해두면 된다. (이건 뒤에서 또 설명)</p>

<p><img width="812" alt="봇 토큰" src="https://github.com/user-attachments/assets/2dc422c8-4e94-4013-b2b6-50e65693c48c" /></p>

<h4 id="3-message-content-intent-옵션">3. “MESSAGE CONTENT INTENT” 옵션</h4>

<p>Bot 섹션(Bot 페이지)에서 <strong>Privileged Gateway Intents</strong> 소제목 아래의 “MESSAGE CONTENT INTENT” 토글을 켜준다.</p>

<p><img width="812" alt="message content intent 옵션" src="https://github.com/user-attachments/assets/8d71367e-f023-4ed9-9924-af411fe1e442" /></p>

<p>Message Content Intent는 봇에게 Prefix 명령어(!play, !stop 등/messageCreate) 실행 시, message.content를 받으려면 켜야 한다. 단, 해당 옵션은 100개 이상 서버에 배포하려면 검증 및 승인 필요하다.</p>

<p>근데 여기서 잠깐! ✋ 슬래시 커맨드(/play)만 쓴다면, 이 Intent 없이도 명령 입력값을 받을 수 있다.</p>

<p>위 설명 방식은 messageCreate를 사용하지만 슬래시 커맨드를 사용한다면 interactionCreate를 사용하여 디스코드 내에서 자동완성 및 도움말을 제공할 수 있다. 단, messageCreate를 사용하여 구현하는 방식보다는 조금 더 만들기 복잡하다.</p>

<ul>
  <li>
    <p><strong>Prefix vs Slash 커맨드 비교</strong></p>

    <table>
      <tbody>
        <tr>
          <td>구분</td>
          <td>Prefix (messageCreate)</td>
          <td>Slash (interactionCreate)</td>
        </tr>
        <tr>
          <td>구현 난이도</td>
          <td>간단 (문자열 파싱)</td>
          <td>배포 스크립트 추가 필요</td>
        </tr>
        <tr>
          <td>사용자 UX</td>
          <td>접두사+명령어 암기 필요</td>
          <td>자동완성·도움말 제공 ✨</td>
        </tr>
        <tr>
          <td>Intent 필요 여부</td>
          <td>Message Content Intent 필요</td>
          <td>불필요</td>
        </tr>
        <tr>
          <td>서버 확장성</td>
          <td>100개 이상 시 Intent 승인 필요</td>
          <td>승인 절차 없이 배포 가능</td>
        </tr>
      </tbody>
    </table>

    <p>Slach 커맨드를 사용하는 것이 사용성을 고려했을 때 더 좋기 때문에.. 이건 추후 해당 방법으로 시도해보도록 하겠다! (일단 이번 글에서는 빠르게 구현이 목적이기 때문에 messageCreate를 사용)</p>
  </li>
</ul>

<h4 id="4-bot을-서버로-초대하기-위한-url-생성">4. Bot을 서버로 초대하기 위한 URL 생성</h4>

<p>OAuth2 섹션에 접속하여 아래 내용들을 켜준다.</p>

<ul>
  <li>SCOPES: <code class="language-plaintext highlighter-rouge">bot</code></li>
  <li>BOT PERMISSIONS:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Connect</code></li>
      <li><code class="language-plaintext highlighter-rouge">Speak</code></li>
      <li><code class="language-plaintext highlighter-rouge">Send Messages</code></li>
      <li><code class="language-plaintext highlighter-rouge">Embed Links</code></li>
    </ul>
  </li>
</ul>

<p>URL 생성 범위를 Bot으로 설정</p>

<p><img width="812" alt="OAuth2 bot 클릭" src="https://github.com/user-attachments/assets/2538966d-b578-4cbd-872e-33febeb28093" /></p>

<p>permisson 설정</p>

<p><img width="812" alt="OAuth2 bot permission 선택" src="https://github.com/user-attachments/assets/bd7f7243-32ab-4d45-bd9b-24ac02e6715c" /></p>

<p>위 설정들을 모두 완료했다면 생성된 ULR에 접속하여, 봇을 사용할 서버에 초대하면 끝!
<img width="812" alt="OAuth2 bot 초대 링크 복사" src="https://github.com/user-attachments/assets/aeb638ec-2924-457c-8c74-d195d6608150" /></p>

<p>그러면 이렇게 디스코드 개발자 설정은 모두 완료되었다. 이제는 VScode를 실행하여 필요 패키지를 설치하고 코드를 작성하면 끝이다.</p>

<h3 id="2-프로젝트-초기-설정">2. 프로젝트 초기 설정</h3>

<p>폴더를 생성하고 프로젝트를 초기화한다.<br />
폴더 이름은 본인이 원하는 것으로 아무거나 해도 된다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm init <span class="nt">-y</span>
</code></pre></div></div>

<h3 id="3-ffmpeg-설치">3. FFmpeg 설치</h3>

<p>FFmpeg는 YouTube 스트림을 디스코드에서 재생 가능한 오디오 포맷(Opus)으로 변환해준다. 설치하지 않을 경우 음성 스트림 변환 과정에서 에러가 발생하기 때문에 꼭 설치해야 한다!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>ffmpeg
</code></pre></div></div>

<h3 id="4-필요-패키지-설치">4. 필요 패키지 설치</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>discord.js @discordjs/voice @distube/ytdl-core yt-search dotenv @discordjs/opus
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">discord.js</code>: 디스코드 API</li>
  <li><code class="language-plaintext highlighter-rouge">@discordjs/voice</code>: 음성 채널 재생</li>
  <li><code class="language-plaintext highlighter-rouge">@distube/ytdl-core</code>: YouTube 스트림 추출</li>
  <li><code class="language-plaintext highlighter-rouge">yt-search</code>: 키워드 기반 검색</li>
  <li><code class="language-plaintext highlighter-rouge">dotenv</code>: 환경변수 관리</li>
  <li><code class="language-plaintext highlighter-rouge">@discordjs/opus</code>: Opus 인코딩</li>
</ul>

<p>여기서 <code class="language-plaintext highlighter-rouge">@discordjs/opus</code>는 우리 코드에서 직접적으로 호출되지는 않는다. 그럼에도 설치를 꼭! 해줘야 한다. 디스코드 음성은 Opus 코덱을 사용해서 전송된다. <code class="language-plaintext highlighter-rouge">@discordjs/voice</code> 패키지는 내부적으로 Opus 스트림을 주고받기 때문에, Node.js 환경에서 Opus 처리를 해 줄 라이브러리가 반드시 있어야 한다. 이때, <code class="language-plaintext highlighter-rouge">@discordjs/opus</code>가 사용된다. 우리가 코드에서 직접 호출하지 않지만 <code class="language-plaintext highlighter-rouge">@discordjs/voice</code>가 자동으로 감지해서 사용한다.</p>

<p>그렇기에 우리 코드에서 사용하지 않는다고 해당 패키지를 삭제해서는 안된다!</p>

<h3 id="5-환경변수-설정-env">5. 환경변수 설정 (.env)</h3>

<pre><code class="language-env">DISCORD_TOKEN=여기에_봇_토큰을_붙여넣기
PREFIX=/
GUILD_ID=여기에_서버_ID_입력
</code></pre>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DISCORD_TOKEN</code>: 위 애플리케이션 생성 단계에서 2. Bot Token 생성에서 얻은 토큰을 넣어주면 된다.</li>
  <li><code class="language-plaintext highlighter-rouge">GUILD_ID</code>: 봇을 허용할 서버 ID. 나의 경우에는 사용할 서버를 제한하는 조건을 넣을 것이기 때문에 해당 서버의 ID가 필요했다. (본인 프로필 설정 - 고급 - 개발자 모드 키고 사용할 서버 우클릭 - 서버 ID 복사하기 클릭)</li>
  <li><code class="language-plaintext highlighter-rouge">PREFIX</code>: 명령어 접두사, 나는 <code class="language-plaintext highlighter-rouge">/</code> 로 사용했다. 다른 접두사도 사용해도 된다. (ex, <code class="language-plaintext highlighter-rouge">!</code>, <code class="language-plaintext highlighter-rouge">?</code> 등)</li>
</ul>

<h3 id="5-gitignore-설정-github에-올릴-경우에만">5. gitignore 설정 (Github에 올릴 경우에만)</h3>

<pre><code class="language-gitignore">node_modules/
.env
</code></pre>

<p>나의 경우에는 Github에 해당 코드를 업로드할 것이기 때문에 gitignore 설정을 해줬다. env 파일의 경우에는 다른 사람에게 공유되면 안되는 중요한 정보들이 들어있기 때문에 Github에 올라가지 않도록 꼭!!!! gitignore에 env 파일을 추가해줘야 한다.</p>

<h3 id="6-indexjs-주요-코드-설명">6. index.js 주요 코드 설명</h3>

<h4 id="1-환경-변수-및-모듈-임포트">1. 환경 변수 및 모듈 임포트</h4>

<p>환경 변수를 로드하고 필요한 모듈을 불러옵니다.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nf">config</span><span class="p">();</span> <span class="c1">// .env 불러오기</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Client</span><span class="p">,</span> <span class="nx">IntentsBitField</span><span class="p">,</span> <span class="nx">EmbedBuilder</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">joinVoiceChannel</span><span class="p">,</span> <span class="nx">createAudioPlayer</span><span class="p">,</span> <span class="nx">createAudioResource</span><span class="p">,</span> <span class="nx">AudioPlayerStatus</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@discordjs/voice</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ytdl</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@distube/ytdl-core</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ytSearch</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">yt-search</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="2-클라이언트-설정">2. 클라이언트 설정</h4>

<p>디스코드 봇 클라이언트를 생성하고, 필요한 인텐트를 설정한다.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 클라이언트 생성 (필요한 인텐트 활성화)</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="p">({</span>
	<span class="na">intents</span><span class="p">:</span> <span class="p">[</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">Guilds</span><span class="p">,</span> <span class="c1">// 서버 접근</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">GuildMessages</span><span class="p">,</span> <span class="c1">// 메시지 읽기</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">MessageContent</span><span class="p">,</span> <span class="c1">// 메시지 내용</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">GuildVoiceStates</span><span class="p">,</span> <span class="c1">// 음성 채널 상태</span>
	<span class="p">],</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">GUILD_ID</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">GUILD_ID</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">queueMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span> <span class="c1">// 서버별 노래 대기열 저장</span>
</code></pre></div></div>

<h4 id="3-봇-로그인-이벤트">3. 봇 로그인 이벤트</h4>

<p>봇이 정상적으로 로그인되면 터미널에 메시지를 출력한다. 만약 터미널에 해당 메시지가 출력되지 않으면 정상적으로 봇이 디스코드에서 작동하지 않을 것이다! 그렇기에 해당 코드를 추가하는 것을 추천한다.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 봇 로그인</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">once</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`✅ 로그인 완료! </span><span class="p">${</span><span class="nx">client</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">tag</span><span class="p">}</span><span class="s2"> (명령어 접두사: </span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h4 id="4-노래-재생-함수-playsong">4. 노래 재생 함수 (<code class="language-plaintext highlighter-rouge">playSong</code>)</h4>

<p>실제 음악 스트림을 생성하고 재생하며, 곡이 끝나면 자동으로 다음 곡을 재생한다.</p>

<ul>
  <li>노래를 정상적으로 재생할 경우</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 곡 재생 함수</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">playSong</span><span class="p">(</span><span class="nx">guildId</span><span class="p">,</span> <span class="nx">song</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">guildId</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">song</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">destroy</span><span class="p">();</span>
		<span class="nx">queueMap</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">guildId</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">// 스트림 생성</span>
	<span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nf">ytdl</span><span class="p">(</span><span class="nx">song</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="na">filter</span><span class="p">:</span> <span class="dl">'</span><span class="s1">audioonly</span><span class="dl">'</span><span class="p">,</span> <span class="na">highWaterMark</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span> <span class="p">});</span>
	<span class="kd">const</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nf">createAudioResource</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">play</span><span class="p">(</span><span class="nx">resource</span><span class="p">);</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">);</span>

	<span class="c1">// 텍스트 알림</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">textChannel</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s2">`▶️ 재생: 🦐 </span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2"> 🦐`</span><span class="p">);</span>

	<span class="c1">// 노래 종료 후 처리</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">once</span><span class="p">(</span><span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Idle</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nf">playSong</span><span class="p">(</span><span class="nx">guildId</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">());</span>
	<span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="5-명령어-처리-messagecreate-이벤트">5. 명령어 처리 (<code class="language-plaintext highlighter-rouge">messageCreate</code> 이벤트)</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/재생</code>: 유튜브 링크나 제목을 통해 음악을 검색 및 재생한다.</li>
  <li><code class="language-plaintext highlighter-rouge">/스킵</code>: 현재 재생 중인 노래를 건너뛴다.</li>
  <li><code class="language-plaintext highlighter-rouge">/대기열</code>: 현재 재생을 기다리는 노래 목록을 보여준다.</li>
  <li><code class="language-plaintext highlighter-rouge">/종료</code>: 음악 재생을 종료하고 봇을 음성 채널에서 내보낸다.</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 메시지 이벤트</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">messageCreate</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">bot</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// 봇의 메시지는 무시</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// DM 등 무시</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">GUILD_ID</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// 지정 서버 외 사용 제한</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">❌ 이 서버에서는 사용할 수 없어요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

	<span class="c1">// 사용자의 명령어만 추출하는 코드</span>
	<span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="sr">/ +/</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nf">shift</span><span class="p">();</span>

	<span class="c1">// 재생 명령어: /재생 &lt;키워드 or URL&gt;</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">재생</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// ... 하단에 세부 코드가 따로 있음.</span>
	<span class="p">}</span>

	<span class="c1">// 스킵 명령어: /스킵</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">스킵</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// ... 하단에 세부 코드가 따로 있음.</span>
	<span class="p">}</span>

	<span class="c1">// 목록 명령어: /대기열</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">대기열</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// ... 하단에 세부 코드가 따로 있음.</span>
	<span class="p">}</span>

	<span class="c1">// 종료 명령어: /종료</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">종료</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// ... 하단에 세부 코드가 따로 있음.</span>
	<span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li>
    <p>재생</p>

    <ul>
      <li>노래 제목이나 URL이 없을 경우: ‘⚠️ 노래 제목이나 URL을 입력해주세요!’</li>
      <li>사용자가 음성 채널에 들어가있지 않을 경우: ‘🎧 먼저 음성 채널에 들어가 주세요!’</li>
      <li>검색 결과가 없을 경우: ‘😥 검색 결과가 없습니다…’</li>
      <li>노래가 재생중인 상태일 때, 노래를 대기열에 정상적으로 추가했을 경우: <code class="language-plaintext highlighter-rouge">✅ 🦐 노래 제목🦐 를 대기열에 추가했어요!</code></li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">재생</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">query</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 노래 제목이나 URL을 입력해주세요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">voiceChannel</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">member</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">voiceChannel</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">🎧 먼저 음성 채널에 들어가 주세요!</span><span class="dl">'</span><span class="p">);</span>

	<span class="c1">// URL인지 확인</span>
	<span class="kd">let</span> <span class="nx">songInfo</span><span class="p">,</span> <span class="nx">song</span><span class="p">;</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">ytdl</span><span class="p">.</span><span class="nf">validateURL</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">songInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ytdl</span><span class="p">.</span><span class="nf">getInfo</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
		<span class="nx">song</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">songInfo</span><span class="p">.</span><span class="nx">videoDetails</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="nx">songInfo</span><span class="p">.</span><span class="nx">videoDetails</span><span class="p">.</span><span class="nx">video_url</span> <span class="p">};</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// 키워드 검색</span>
		<span class="kd">const</span> <span class="p">{</span> <span class="nx">videos</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">ytSearch</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">videos</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">😥 검색 결과가 없습니다...</span><span class="dl">'</span><span class="p">);</span>
		<span class="nx">song</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="nx">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">url</span> <span class="p">};</span>
	<span class="p">}</span>

	<span class="c1">// 대기열 관리</span>
	<span class="kd">let</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// 1) 플레이어를 생성하고</span>
		<span class="kd">const</span> <span class="nx">player</span> <span class="o">=</span> <span class="nf">createAudioPlayer</span><span class="p">();</span>
		<span class="c1">// 2) 에러 핸들러 등록 (스트림 에러 시 다음 곡으로 넘어가도록)</span>
		<span class="nx">player</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">🔴 AudioPlayerError:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
			<span class="c1">// 다음 곡 재생 시도</span>
			<span class="nf">playSong</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">());</span>
		<span class="p">});</span> <span class="c1">// 3) 큐 객체에 player를 포함시켜 저장</span>
		<span class="nx">queue</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">voiceChannel</span><span class="p">,</span>
			<span class="na">textChannel</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span>
			<span class="nx">player</span><span class="p">,</span>
			<span class="na">songs</span><span class="p">:</span> <span class="p">[],</span>
		<span class="p">};</span>
		<span class="nx">queueMap</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">);</span>

		<span class="c1">// 채널 조인</span>
		<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nf">joinVoiceChannel</span><span class="p">({</span>
			<span class="na">channelId</span><span class="p">:</span> <span class="nx">voiceChannel</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
			<span class="na">guildId</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
			<span class="na">adapterCreator</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">voiceAdapterCreator</span><span class="p">,</span>
		<span class="p">});</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>
		<span class="nf">playSong</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">()</span> <span class="o">||</span> <span class="nx">song</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">song</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="s2">`✅ 🦐 </span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2"> 🦐 를 대기열에 추가했어요!`</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>결과</strong><br />
<img width="820" alt="재생" src="https://github.com/user-attachments/assets/a66466cb-3174-46c6-b94d-411bd214d0a4" /></p>
  </li>
  <li>
    <p>스킵</p>

    <ul>
      <li>스킵할 노래가 없을 경우: ‘⚠️ 스킵할 노래가 없어요!’’</li>
      <li>노래를 정상적으로 스킵할 경우: ‘⏭️ 노래를 스킵합니다!’</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 스킵 명령어: /스킵</span>
<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">스킵</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
	<span class="c1">// 1) 큐가 없거나, 2) 재생 중인 노래가 없고 대기열도 비어 있으면</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Playing</span> <span class="o">&amp;&amp;</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 스킵할 노래가 없어요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">stop</span><span class="p">();</span>
	<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⏭️ 노래를 스킵합니다!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>결과</strong><br />
<img width="820" alt="스킵" src="https://github.com/user-attachments/assets/691f94ad-eeb5-4c43-bd7a-eae6b5292320" /></p>
  </li>
  <li>
    <p>대기열</p>

    <ul>
      <li>대기열이 비어있을 경우: ‘📃 대기열이 비어있어요!’</li>
      <li>재생 대기열이 존재할 경우: ‘🎵 재생 대기열 ~~’</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 목록 명령어: /대기열</span>
<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">대기열</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">📃 대기열이 비어있어요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kd">const</span> <span class="nx">embed</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EmbedBuilder</span><span class="p">()</span>
		<span class="p">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="dl">'</span><span class="s1">🎵 재생 대기열</span><span class="dl">'</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">setDescription</span><span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">. </span><span class="p">${</span><span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">))</span>
		<span class="p">.</span><span class="nf">setColor</span><span class="p">(</span><span class="dl">'</span><span class="s1">#7E51F4</span><span class="dl">'</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">embed</span><span class="p">]</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>결과</strong><br />
<img width="820" alt="대기열" src="https://github.com/user-attachments/assets/f7572bf1-e1af-47ec-880f-c3d429433177" /></p>
  </li>
  <li>
    <p>종료</p>

    <ul>
      <li>종료할 곡이 없을 경우: ‘⚠️ 종료할 곡이 없어요!’</li>
      <li>노래를 정상적으로 종료했을 경우: ‘👋 노래를 종료하고 🦐대하는 떠납니다!’</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 종료 명령어: /종료</span>
<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">종료</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

	<span class="c1">// 1) 큐가 없거나,</span>
	<span class="c1">// 2) 재생 중인 곡이 없고(플레이어가 Playing 상태가 아니고),</span>
	<span class="c1">//    대기열(songs)도 비어 있으면</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Playing</span> <span class="o">&amp;&amp;</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 종료할 곡이 없어요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">stop</span><span class="p">();</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">destroy</span><span class="p">();</span>
	<span class="nx">queueMap</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">👋 노래를 종료하고 🦐대하는 떠납니다!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>결과</strong><br />
<img width="820" alt="종료" src="https://github.com/user-attachments/assets/74c92d45-62ba-48e9-96a4-581af1d99dc1" /></p>
  </li>
</ul>

<h2 id="-내가-겪은-오류와-해결방법">🚨 내가 겪은 오류와 해결방법</h2>

<h3 id="-문제-상황">🐞 문제 상황</h3>

<p>npm run start를 통해 코드를 실행시키면 아래와 같은 경고가 발생했다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm WARN EBADENGINE Unsupported engine <span class="o">{</span>
npm WARN EBADENGINE   required: <span class="o">{</span> node: <span class="s1">'20 || &gt;=22'</span> <span class="o">}</span>,
npm WARN EBADENGINE   current: <span class="o">{</span> node: <span class="s1">'v21.0.0'</span>, npm: <span class="s1">'9.5.1'</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>해당 메시지는 설치하는 패키지들이 현재 사용 중인 Node.js 버전(<strong>21.0.0</strong>)을 공식적으로 지원하지 않는다는 의미이다.</p>

<h3 id="-원인-분석">💡 원인 분석</h3>

<p>Node.js는 크게 두 가지 방식으로 버전을 관리한다.</p>

<ul>
  <li><strong>짝수 버전(20, 22, 24 등)</strong> 👉 장기 지원(LTS) 버전</li>
  <li><strong>홀수 버전(21, 23 등)</strong> 👉 단기 지원, 실험적인 버전</li>
</ul>

<p>많은 라이브러리와 패키지들은 <strong>안정성이 보장된 LTS 버전만 공식 지원</strong> 하도록 제한을 걸어둔다. 해당 경고는 Node.js의 현재 버전(<strong>21.x</strong>)이 짝수인 20버전이나 22 이상의 버전으로 설정된 지원 범위에서 벗어나기 때문에 나타난다.</p>

<h3 id="-해결-방법">✅ 해결 방법</h3>

<p>가장 권장되는 방법은 <strong>Node.js의 LTS 버전을 사용</strong> 하는 것이다.</p>

<h3 id="-nvm으로-lts-버전-설치하기">🔖 <code class="language-plaintext highlighter-rouge">nvm</code>으로 LTS 버전 설치하기</h3>

<p>다음 명령어를 사용하면 손쉽게 버전을 바꿀 수 있다. (단, 해당 방법은 <code class="language-plaintext highlighter-rouge">nvm</code>으로 Node를 설치 했을 경우에만 가능하다.)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># LTS 최신 버전(v22.x) 설치</span>
nvm <span class="nb">install </span>v22.14.0

<span class="c"># 설치된 LTS 버전 사용하기</span>
nvm use v22.14.0
</code></pre></div></div>

<p>이렇게 하면 경고가 사라지고 패키지와의 호환성 문제가 해결된다!</p>

<h2 id="-명령어-사용-방법">📝 명령어 사용 방법</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/재생 [유튜브 링크 또는 제목]</code></li>
  <li><code class="language-plaintext highlighter-rouge">/스킵</code>: 현재 재생중인 노래를 스킵</li>
  <li><code class="language-plaintext highlighter-rouge">/대기열</code>: 재생 대기 중인 곡들을 리스트로 출력</li>
  <li><code class="language-plaintext highlighter-rouge">/종료</code>: 봇의 노래 재생 종료</li>
</ul>

<h2 id="️-봇-실행하기">🖥️ 봇 실행하기</h2>

<p>터미널에서 다음 명령어로 봇을 실행한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node index.js
<span class="c"># 또는 개발 시 nodemon 활용</span>
npm <span class="nb">install</span> <span class="nt">-g</span> nodemon
nodemon index.js
</code></pre></div></div>

<p>두 명령어로 실행이 가능한데 매번 저렇게 터미널에 작성하기 귀찮으니 package.json의 스크립트에 만들어두자.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//...</span><span class="w">
	</span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node index.js"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nodemon index.js"</span><span class="w">
	</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">//...</span><span class="w">
</span></code></pre></div></div>

<h2 id="개발을-마치며">개발을 마치며</h2>

<p>디스코드 노래봇 사용하다가 빡쳐서 만들었는데 어쩌다 보니 그닥 어렵지도 않고 만들고 사용하면서 지난번에 다른 사람들이 제작한 봇을 사용했을 때 보다 음질이 더 좋아서 아주 만족했다! 다음번에는 내가 서버를 열지 않아도 자동으로 서버가 계속 열려있을 수 있도록 ec2도 사용하고 디스코드에 노래봇을 사용할 때 명령어와 설명이 나올 수 있도록 interactionCreate를 사용해서 더 디벨롭해볼 예정이다.</p>

<p>그럼 아래에 index.js 풀 코드를 올리며 이만~ 오늘 글 끝!</p>

<h2 id="indexjs-풀-코드">index.js 풀 코드</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nf">config</span><span class="p">();</span> <span class="c1">// .env 불러오기</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Client</span><span class="p">,</span> <span class="nx">IntentsBitField</span><span class="p">,</span> <span class="nx">EmbedBuilder</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">joinVoiceChannel</span><span class="p">,</span> <span class="nx">createAudioPlayer</span><span class="p">,</span> <span class="nx">createAudioResource</span><span class="p">,</span> <span class="nx">AudioPlayerStatus</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@discordjs/voice</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ytdl</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@distube/ytdl-core</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ytSearch</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">yt-search</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 클라이언트 생성 (필요한 인텐트 활성화)</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="p">({</span>
	<span class="na">intents</span><span class="p">:</span> <span class="p">[</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">Guilds</span><span class="p">,</span> <span class="c1">// 서버 접근</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">GuildMessages</span><span class="p">,</span> <span class="c1">// 메시지 읽기</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">MessageContent</span><span class="p">,</span> <span class="c1">// 메시지 내용</span>
		<span class="nx">IntentsBitField</span><span class="p">.</span><span class="nx">Flags</span><span class="p">.</span><span class="nx">GuildVoiceStates</span><span class="p">,</span> <span class="c1">// 음성 채널 상태</span>
	<span class="p">],</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">GUILD_ID</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">GUILD_ID</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">queueMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span> <span class="c1">// 서버별 노래 대기열 저장</span>

<span class="c1">// 봇 로그인</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">once</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`✅ 로그인 완료! </span><span class="p">${</span><span class="nx">client</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">tag</span><span class="p">}</span><span class="s2"> (명령어 접두사: </span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 메시지 이벤트</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">messageCreate</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">bot</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// 봇의 메시지는 무시</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// DM 등 무시</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">GUILD_ID</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// 지정 서버 외 사용 제한</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">❌ 이 서버에서는 사용할 수 없어요!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

	<span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="sr">/ +/</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nf">shift</span><span class="p">();</span>

	<span class="c1">// 재생 명령어: /재생 &lt;키워드 or URL&gt;</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">재생</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">query</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 노래 제목이나 URL을 입력해주세요!</span><span class="dl">'</span><span class="p">);</span>
		<span class="kd">const</span> <span class="nx">voiceChannel</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">member</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">voiceChannel</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">🎧 먼저 음성 채널에 들어가 주세요!</span><span class="dl">'</span><span class="p">);</span>

		<span class="c1">// URL인지 확인</span>
		<span class="kd">let</span> <span class="nx">songInfo</span><span class="p">,</span> <span class="nx">song</span><span class="p">;</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">ytdl</span><span class="p">.</span><span class="nf">validateURL</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">songInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ytdl</span><span class="p">.</span><span class="nf">getInfo</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
			<span class="nx">song</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">songInfo</span><span class="p">.</span><span class="nx">videoDetails</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="nx">songInfo</span><span class="p">.</span><span class="nx">videoDetails</span><span class="p">.</span><span class="nx">video_url</span> <span class="p">};</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="c1">// 키워드 검색</span>
			<span class="kd">const</span> <span class="p">{</span> <span class="nx">videos</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">ytSearch</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
			<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">videos</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">😥 검색 결과가 없습니다...</span><span class="dl">'</span><span class="p">);</span>
			<span class="nx">song</span> <span class="o">=</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="nx">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">url</span> <span class="p">};</span>
		<span class="p">}</span>

		<span class="c1">// 대기열 관리</span>
		<span class="kd">let</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// queue = { voiceChannel, textChannel: message.channel, player: createAudioPlayer(), songs: [] };</span>
			<span class="c1">// 1) 플레이어를 생성하고</span>
			<span class="kd">const</span> <span class="nx">player</span> <span class="o">=</span> <span class="nf">createAudioPlayer</span><span class="p">();</span>
			<span class="c1">// 2) 에러 핸들러 등록 (스트림 에러 시 다음 곡으로 넘어가도록)</span>
			<span class="nx">player</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
				<span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">🔴 AudioPlayerError:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
				<span class="c1">// 다음 곡 재생 시도</span>
				<span class="nf">playSong</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">());</span>
			<span class="p">});</span> <span class="c1">// 3) 큐 객체에 player를 포함시켜 저장</span>
			<span class="nx">queue</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">voiceChannel</span><span class="p">,</span>
				<span class="na">textChannel</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span>
				<span class="nx">player</span><span class="p">,</span>
				<span class="na">songs</span><span class="p">:</span> <span class="p">[],</span>
			<span class="p">};</span>
			<span class="nx">queueMap</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">);</span>

			<span class="c1">// 채널 조인</span>
			<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nf">joinVoiceChannel</span><span class="p">({</span>
				<span class="na">channelId</span><span class="p">:</span> <span class="nx">voiceChannel</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
				<span class="na">guildId</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
				<span class="na">adapterCreator</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">voiceAdapterCreator</span><span class="p">,</span>
			<span class="p">});</span>
			<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>
			<span class="nf">playSong</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">()</span> <span class="o">||</span> <span class="nx">song</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">song</span><span class="p">);</span>
			<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="s2">`✅ 🦐 </span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2"> 🦐 를 대기열에 추가했어요!`</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// 스킵 명령어: /스킵</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">스킵</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
		<span class="c1">// 1) 큐가 없거나, 2) 재생 중인 노래가 없고 대기열도 비어 있으면</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Playing</span> <span class="o">&amp;&amp;</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 스킵할 노래가 없어요!</span><span class="dl">'</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">stop</span><span class="p">();</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⏭️ 노래를 스킵합니다!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// 목록 명령어: /대기열</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">대기열</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">📃 대기열이 비어있어요!</span><span class="dl">'</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="kd">const</span> <span class="nx">embed</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EmbedBuilder</span><span class="p">()</span>
			<span class="p">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="dl">'</span><span class="s1">🎵 재생 대기열</span><span class="dl">'</span><span class="p">)</span>
			<span class="p">.</span><span class="nf">setDescription</span><span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">. </span><span class="p">${</span><span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">))</span>
			<span class="p">.</span><span class="nf">setColor</span><span class="p">(</span><span class="dl">'</span><span class="s1">#7E51F4</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">embed</span><span class="p">]</span> <span class="p">});</span>
	<span class="p">}</span>

	<span class="c1">// 종료 명령어: /종료</span>
	<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">cmd</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">종료</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

		<span class="c1">// 1) 큐가 없거나,</span>
		<span class="c1">// 2) 재생 중인 곡이 없고(플레이어가 Playing 상태가 아니고),</span>
		<span class="c1">//    대기열(songs)도 비어 있으면</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Playing</span> <span class="o">&amp;&amp;</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">⚠️ 종료할 곡이 없어요!</span><span class="dl">'</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">stop</span><span class="p">();</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">destroy</span><span class="p">();</span>
		<span class="nx">queueMap</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guild</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nf">reply</span><span class="p">(</span><span class="dl">'</span><span class="s1">👋 노래를 종료하고 🦐대하는 떠납니다!</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 곡 재생 함수</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">playSong</span><span class="p">(</span><span class="nx">guildId</span><span class="p">,</span> <span class="nx">song</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">queueMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">guildId</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">song</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">destroy</span><span class="p">();</span>
		<span class="nx">queueMap</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">guildId</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">// 스트림 생성</span>
	<span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nf">ytdl</span><span class="p">(</span><span class="nx">song</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="na">filter</span><span class="p">:</span> <span class="dl">'</span><span class="s1">audioonly</span><span class="dl">'</span><span class="p">,</span> <span class="na">highWaterMark</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span> <span class="p">});</span>
	<span class="kd">const</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nf">createAudioResource</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">play</span><span class="p">(</span><span class="nx">resource</span><span class="p">);</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">);</span>

	<span class="c1">// 텍스트 알림</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">textChannel</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s2">`▶️ 재생: 🦐 </span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2"> 🦐`</span><span class="p">);</span>

	<span class="c1">// 노래 종료 후 처리</span>
	<span class="nx">queue</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nf">once</span><span class="p">(</span><span class="nx">AudioPlayerStatus</span><span class="p">.</span><span class="nx">Idle</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nf">playSong</span><span class="p">(</span><span class="nx">guildId</span><span class="p">,</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nf">shift</span><span class="p">());</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 로그인 실행</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">login</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISCORD_TOKEN</span><span class="p">);</span>
</code></pre></div></div>

    



<div class="post-tags">
  
    
    <a href="/tags.html#til">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">TIL</span>
    </a>
  
    
    <a href="/tags.html#discord">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Discord</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <p>
    You are seeing this because your Disqus shortname is not properly set. To
    configure Disqus, you should edit your <code>_config.yml</code> to include
    either a <code>disqus.shortname</code> variable.
  </p>

  <p>
    If you do not wish to use Disqus, override the
    <code>comments.html</code> partial for this theme.
  </p>


  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/til/2025/03/06/M3D-Blog-Create-Sitemap-and-Error-Solution.html">
            jekyll Github 블로그 sitemap 파일 생성하기 & `ERROR: While executing gem ... (Gem::FilePermissionError)` 에러 해결방법
            <small>06 Mar 2025</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/til/2025/02/28/M3D-Session-Local-Storage.html">
            매3개 | 브라우저 저장소 (Session Storage, Local Storage, Cookie)
            <small>28 Feb 2025</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/til/2025/02/25/M3D-Git-Merge.html">
            매3개 | Git의 다양한 Merge 방법 (merge, rebase, squash)
            <small>25 Feb 2025</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>
</main>

		<!-- Optional footer content -->

	</body>
</html>
